<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Sync Test - Heros</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .panel {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 30px;
        }
        
        .btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.5);
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px;
            transition: all 0.3s ease;
            font-size: 16px;
            display: inline-block;
            text-decoration: none;
            text-align: center;
        }
        
        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .btn.primary {
            background: rgba(40, 167, 69, 0.8);
            border-color: #28a745;
        }
        
        .btn.danger {
            background: rgba(220, 53, 69, 0.8);
            border-color: #dc3545;
        }
        
        .status {
            background: rgba(0,0,0,0.4);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
            border-left: 4px solid #28a745;
        }
        
        .log {
            background: rgba(0,0,0,0.6);
            padding: 20px;
            border-radius: 8px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel">
            <h1>üîß Simple Real-time Sync Test</h1>
            <p>This page tests if the bulletproof sync system is working correctly.</p>
            
            <div class="status" id="sync-status">
                <strong>Status:</strong> <span id="status-text">Initializing...</span><br>
                <strong>Domain:</strong> <span id="domain-text"></span><br>
                <strong>Settings Found:</strong> <span id="settings-found">Checking...</span>
            </div>
        </div>

        <div class="grid">
            <div class="panel">
                <h3>üß™ Manual Tests</h3>
                <button class="btn primary" onclick="testDiabetesCare()">Toggle Diabetes Care</button>
                <button class="btn primary" onclick="testWeightLoss()">Toggle Weight Loss</button>
                <button class="btn" onclick="createTestSettings()">Create Test Settings</button>
                <button class="btn danger" onclick="clearAllSettings()">Clear All Settings</button>
            </div>

            <div class="panel">
                <h3>üîó Quick Links</h3>
                <a href="settings.html" target="_blank" class="btn">‚öôÔ∏è Open Settings</a>
                <a href="index.html" target="_blank" class="btn">üåê Open Main Site</a>
                <button class="btn" onclick="checkSyncStatus()">üîç Check Status</button>
                <button class="btn" onclick="forceSyncTest()">‚ö° Force Sync</button>
            </div>
        </div>

        <div class="panel">
            <h3>üìä Activity Log</h3>
            <div class="log" id="activity-log">
                <div class="info">[Starting] Simple sync test initialized</div>
            </div>
            <button class="btn" onclick="clearLog()">üóëÔ∏è Clear Log</button>
        </div>

        <div class="panel">
            <h3>üìã Instructions</h3>
            <ol style="line-height: 1.8;">
                <li><strong>Click "Create Test Settings"</strong> to set up test data</li>
                <li><strong>Open the Settings page</strong> in another tab</li>
                <li><strong>Open the Main Site</strong> in another tab</li>
                <li><strong>Change settings in Settings tab</strong> and watch for immediate updates</li>
                <li><strong>Use manual toggles above</strong> to test from this page</li>
                <li><strong>Monitor the activity log</strong> for sync events</li>
            </ol>
        </div>
    </div>

    <script src="realtime-sync-fix.js"></script>
    <script>
        let logCount = 0;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('activity-log');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            logCount++;
        }

        function updateStatus() {
            document.getElementById('domain-text').textContent = window.location.hostname;
            
            const settingsData = localStorage.getItem('herosSiteSettings');
            if (settingsData) {
                try {
                    const settings = JSON.parse(settingsData);
                    const count = Object.keys(settings).length;
                    document.getElementById('settings-found').textContent = `Yes (${count} settings)`;
                    document.getElementById('status-text').textContent = 'Ready for testing';
                } catch (error) {
                    document.getElementById('settings-found').textContent = 'Invalid JSON';
                    document.getElementById('status-text').textContent = 'Settings error';
                }
            } else {
                document.getElementById('settings-found').textContent = 'No settings found';
                document.getElementById('status-text').textContent = 'No settings - create test settings';
            }
        }

        function testDiabetesCare() {
            toggleSpecificSetting('menu-diabetes-care', 'Diabetes Care Menu');
        }

        function testWeightLoss() {
            toggleSpecificSetting('section-weight-loss', 'Weight Loss Section');
        }

        function toggleSpecificSetting(settingKey, displayName) {
            const settings = JSON.parse(localStorage.getItem('herosSiteSettings') || '{}');
            const oldValue = settings[settingKey];
            const newValue = !oldValue;
            
            settings[settingKey] = newValue;
            localStorage.setItem('herosSiteSettings', JSON.stringify(settings));
            
            const changeNotification = {
                timestamp: Date.now(),
                setting: settingKey,
                value: newValue,
                action: 'manual-test',
                source: 'sync-test-simple'
            };
            localStorage.setItem('herosSettingsChange', JSON.stringify(changeNotification));
            
            log(`üîÄ Toggled ${displayName}: ${oldValue} ‚Üí ${newValue}`, 'success');
            
            // Try to broadcast if the sync fix is available
            if (window.HerosSyncFix) {
                window.HerosSyncFix.broadcast();
                log('üì¢ Broadcast sent via HerosSyncFix', 'info');
            }
            
            updateStatus();
        }

        function createTestSettings() {
            const testSettings = {
                'menu-weight-loss': true,
                'menu-mens-ed': true,
                'menu-skin-care': true,
                'menu-hair-regrowth': true,
                'menu-nad-plus': true,
                'menu-diabetes-care': false, // Disabled for visible testing
                
                'section-hero': true,
                'section-service-cards': true,
                'section-products': true,
                'section-weight-loss': false, // Disabled for visible testing
                'section-ed-meds': true,
                
                'carousel-weight-loss': true,
                'carousel-diabetes-care': false, // Disabled for visible testing
                'carousel-hair-regrowth': true,
                
                'test-created': true,
                'test-timestamp': Date.now(),
                'test-domain': window.location.hostname
            };
            
            localStorage.setItem('herosSiteSettings', JSON.stringify(testSettings));
            
            const changeNotification = {
                timestamp: Date.now(),
                setting: 'bulk-test-creation',
                action: 'create-test-settings',
                source: 'sync-test-simple'
            };
            localStorage.setItem('herosSettingsChange', JSON.stringify(changeNotification));
            
            log('‚úÖ Test settings created with some items disabled for testing', 'success');
            updateStatus();
            
            if (window.HerosSyncFix) {
                window.HerosSyncFix.broadcast();
                log('üì¢ Broadcast sent for test settings', 'info');
            }
        }

        function clearAllSettings() {
            if (confirm('Clear all settings? This cannot be undone.')) {
                localStorage.removeItem('herosSiteSettings');
                localStorage.removeItem('herosSettingsChange');
                
                log('üóëÔ∏è All settings cleared', 'warning');
                updateStatus();
                
                if (window.HerosSyncFix) {
                    window.HerosSyncFix.broadcast();
                    log('üì¢ Broadcast sent for settings clear', 'info');
                }
            }
        }

        function checkSyncStatus() {
            if (window.HerosSyncFix) {
                window.HerosSyncFix.status();
                log('üîç Sync status logged to console', 'info');
            } else {
                log('‚ùå HerosSyncFix not available', 'error');
            }
        }

        function forceSyncTest() {
            if (window.HerosSyncFix) {
                window.HerosSyncFix.test();
                log('‚ö° Force sync test executed', 'success');
            } else {
                log('‚ùå HerosSyncFix not available for force test', 'error');
            }
        }

        function clearLog() {
            document.getElementById('activity-log').innerHTML = '<div class="info">[Cleared] Log cleared manually</div>';
            logCount = 0;
        }

        // Monitor for storage changes
        window.addEventListener('storage', function(e) {
            if (e.key === 'herosSiteSettings' || e.key === 'herosSettingsChange') {
                log(`üì° Storage event: ${e.key}`, 'info');
                updateStatus();
            }
        });

        // Monitor for custom events
        window.addEventListener('heros-force-sync', function() {
            log('‚ö° Custom sync event received', 'success');
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus();
            log('‚úÖ Simple sync test page ready', 'success');
            
            // Check if sync fix is loaded
            setTimeout(() => {
                if (window.HerosSyncFix) {
                    log('‚úÖ HerosSyncFix loaded successfully', 'success');
                } else {
                    log('‚ùå HerosSyncFix failed to load', 'error');
                }
            }, 1000);
        });
    </script>
</body>
</html>
