<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domain Agnostic Test - Heros</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-card {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .test-result {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
        }
        
        .test-pass {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid #28a745;
            color: #d4edda;
        }
        
        .test-fail {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
            color: #f8d7da;
        }
        
        .test-info {
            background: rgba(23, 162, 184, 0.2);
            border: 1px solid #17a2b8;
            color: #d1ecf1;
        }
        
        .btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.5);
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }
        
        .btn.primary {
            background: rgba(40, 167, 69, 0.8);
            border-color: #28a745;
        }
        
        .btn.secondary {
            background: rgba(255, 193, 7, 0.8);
            border-color: #ffc107;
            color: #000;
        }
        
        .domain-info {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-item {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
        }
        
        .status-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .status-label {
            font-size: 12px;
            opacity: 0.8;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌐 Domain Agnostic Settings Test</h1>
            <p>Verify that the settings system works identically on any domain</p>
            <div class="domain-info">
                <strong>Current Domain:</strong> <span id="current-domain"></span><br>
                <strong>Full URL:</strong> <span id="current-url"></span>
            </div>
        </div>

        <div class="test-grid">
            <div class="test-card">
                <h3>🔧 Settings System Test</h3>
                <button class="btn primary" onclick="runSettingsTests()">🧪 Run All Tests</button>
                <div id="settings-test-results">
                    <div class="test-info">Click "Run All Tests" to verify domain agnostic functionality</div>
                </div>
            </div>

            <div class="test-card">
                <h3>📊 Current Settings Status</h3>
                <button class="btn" onclick="refreshStatus()">🔄 Refresh Status</button>
                <div class="status-grid" id="settings-status">
                    <div class="status-item">
                        <div class="status-number" id="total-settings">-</div>
                        <div class="status-label">Total Settings</div>
                    </div>
                    <div class="status-item">
                        <div class="status-number" id="enabled-settings">-</div>
                        <div class="status-label">Enabled</div>
                    </div>
                    <div class="status-item">
                        <div class="status-number" id="disabled-settings">-</div>
                        <div class="status-label">Disabled</div>
                    </div>
                </div>
            </div>

            <div class="test-card">
                <h3>🔗 URL Parameter Test</h3>
                <button class="btn" onclick="testURLParameters()">🧪 Test URL Import</button>
                <button class="btn secondary" onclick="generateTestURL()">🔗 Generate Test URL</button>
                <div id="url-test-results">
                    <div class="test-info">Test URL parameter-based settings import</div>
                </div>
            </div>

            <div class="test-card">
                <h3>💾 LocalStorage Test</h3>
                <button class="btn" onclick="testLocalStorage()">🧪 Test Storage</button>
                <button class="btn" onclick="createTestSettings()">⚡ Create Test Data</button>
                <div id="storage-test-results">
                    <div class="test-info">Verify localStorage functionality</div>
                </div>
            </div>
        </div>

        <div class="test-card">
            <h3>🎯 Quick Actions</h3>
            <div style="text-align: center;">
                <button class="btn primary" onclick="window.open('settings.html', '_blank')">⚙️ Open Settings Page</button>
                <button class="btn primary" onclick="window.open('index.html', '_blank')">🏠 Open Main Site</button>
                <button class="btn secondary" onclick="createDemoSettings()">🎭 Create Demo Settings</button>
                <button class="btn" onclick="clearAllData()">🗑️ Clear All Data</button>
            </div>
        </div>

        <div class="test-card">
            <h3>📋 Test Results Summary</h3>
            <div id="test-summary">
                <div class="test-info">Run tests to see results summary</div>
            </div>
        </div>
    </div>

    <script>
        let testResults = {
            settingsTests: 0,
            urlTests: 0,
            storageTests: 0,
            totalTests: 0,
            passedTests: 0
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('current-domain').textContent = window.location.hostname;
            document.getElementById('current-url').textContent = window.location.href;
            refreshStatus();
        });

        function addTestResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const result = document.createElement('div');
            result.className = `test-result test-${type}`;
            result.textContent = message;
            container.appendChild(result);
            
            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
        }

        function clearTestResults(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
        }

        function runSettingsTests() {
            clearTestResults('settings-test-results');
            testResults.settingsTests = 0;
            
            addTestResult('settings-test-results', '🧪 Starting settings system tests...', 'info');
            
            // Test 1: LocalStorage access
            try {
                localStorage.setItem('test-key', 'test-value');
                const retrieved = localStorage.getItem('test-key');
                localStorage.removeItem('test-key');
                
                if (retrieved === 'test-value') {
                    addTestResult('settings-test-results', '✅ LocalStorage read/write: PASS', 'pass');
                    testResults.settingsTests++;
                } else {
                    addTestResult('settings-test-results', '❌ LocalStorage read/write: FAIL', 'fail');
                }
            } catch (error) {
                addTestResult('settings-test-results', `❌ LocalStorage error: ${error.message}`, 'fail');
            }
            testResults.totalTests++;
            
            // Test 2: Settings data structure
            try {
                const settingsData = localStorage.getItem('herosSiteSettings');
                if (settingsData) {
                    const settings = JSON.parse(settingsData);
                    if (typeof settings === 'object' && settings !== null) {
                        addTestResult('settings-test-results', `✅ Settings structure: PASS (${Object.keys(settings).length} items)`, 'pass');
                        testResults.settingsTests++;
                    } else {
                        addTestResult('settings-test-results', '❌ Settings structure: FAIL (invalid object)', 'fail');
                    }
                } else {
                    addTestResult('settings-test-results', '⚠️ Settings structure: NO DATA (will create defaults)', 'info');
                    testResults.settingsTests++;
                }
            } catch (error) {
                addTestResult('settings-test-results', `❌ Settings parsing error: ${error.message}`, 'fail');
            }
            testResults.totalTests++;
            
            // Test 3: Universal controls
            setTimeout(() => {
                const fabButton = document.querySelector('[title="Universal Settings Menu"]');
                if (fabButton) {
                    addTestResult('settings-test-results', '✅ Universal controls: PASS (FAB found)', 'pass');
                    testResults.settingsTests++;
                } else {
                    addTestResult('settings-test-results', '❌ Universal controls: FAIL (FAB not found)', 'fail');
                }
                testResults.totalTests++;
                
                testResults.passedTests += testResults.settingsTests;
                updateTestSummary();
            }, 1000);
        }

        function testURLParameters() {
            clearTestResults('url-test-results');
            
            addTestResult('url-test-results', '🧪 Testing URL parameter functionality...', 'info');
            
            // Test URL parameter parsing
            const testSettings = {
                'menu-diabetes-care': false,
                'menu-weight-loss': true,
                'test-setting': false
            };
            
            try {
                const encoded = btoa(JSON.stringify(testSettings));
                const testURL = `${window.location.origin}/index.html?settings=${encoded}`;
                
                addTestResult('url-test-results', '✅ URL encoding: PASS', 'pass');
                addTestResult('url-test-results', `📏 URL length: ${testURL.length} characters`, 'info');
                
                // Test decoding
                const urlParams = new URLSearchParams(`?settings=${encoded}`);
                const settingsParam = urlParams.get('settings');
                const decoded = JSON.parse(atob(settingsParam));
                
                if (JSON.stringify(decoded) === JSON.stringify(testSettings)) {
                    addTestResult('url-test-results', '✅ URL decoding: PASS', 'pass');
                    testResults.urlTests += 2;
                } else {
                    addTestResult('url-test-results', '❌ URL decoding: FAIL', 'fail');
                }
                
                testResults.totalTests += 2;
                testResults.passedTests += testResults.urlTests;
                updateTestSummary();
                
            } catch (error) {
                addTestResult('url-test-results', `❌ URL test error: ${error.message}`, 'fail');
                testResults.totalTests += 2;
                updateTestSummary();
            }
        }

        function generateTestURL() {
            try {
                const testSettings = {
                    'menu-diabetes-care': false,
                    'menu-weight-loss': true,
                    'carousel-diabetes-care': false,
                    'section-weight-loss': true,
                    'test-domain-agnostic': true
                };
                
                const encoded = btoa(JSON.stringify(testSettings));
                const testURL = `${window.location.origin}/index.html?settings=${encoded}`;
                
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(testURL).then(() => {
                        alert('🔗 Test URL copied to clipboard!\n\nThis URL will work on any domain and automatically import the test settings.');
                    });
                } else {
                    prompt('Copy this test URL:', testURL);
                }
                
                addTestResult('url-test-results', '✅ Test URL generated and copied', 'pass');
                
            } catch (error) {
                addTestResult('url-test-results', `❌ Error generating test URL: ${error.message}`, 'fail');
            }
        }

        function testLocalStorage() {
            clearTestResults('storage-test-results');
            
            addTestResult('storage-test-results', '🧪 Testing localStorage functionality...', 'info');
            
            const tests = [
                {
                    name: 'Basic read/write',
                    test: () => {
                        localStorage.setItem('test-basic', 'value');
                        const result = localStorage.getItem('test-basic');
                        localStorage.removeItem('test-basic');
                        return result === 'value';
                    }
                },
                {
                    name: 'JSON data handling',
                    test: () => {
                        const testObj = { test: true, value: 123 };
                        localStorage.setItem('test-json', JSON.stringify(testObj));
                        const retrieved = JSON.parse(localStorage.getItem('test-json'));
                        localStorage.removeItem('test-json');
                        return retrieved.test === true && retrieved.value === 123;
                    }
                },
                {
                    name: 'Large data handling',
                    test: () => {
                        const largeData = 'x'.repeat(10000);
                        localStorage.setItem('test-large', largeData);
                        const retrieved = localStorage.getItem('test-large');
                        localStorage.removeItem('test-large');
                        return retrieved.length === 10000;
                    }
                }
            ];
            
            let passed = 0;
            
            tests.forEach(test => {
                try {
                    if (test.test()) {
                        addTestResult('storage-test-results', `✅ ${test.name}: PASS`, 'pass');
                        passed++;
                    } else {
                        addTestResult('storage-test-results', `❌ ${test.name}: FAIL`, 'fail');
                    }
                } catch (error) {
                    addTestResult('storage-test-results', `❌ ${test.name}: ERROR - ${error.message}`, 'fail');
                }
            });
            
            testResults.storageTests = passed;
            testResults.totalTests += tests.length;
            testResults.passedTests += passed;
            updateTestSummary();
        }

        function createTestSettings() {
            const testSettings = {
                'menu-weight-loss': true,
                'menu-mens-ed': true,
                'menu-skin-care': true,
                'menu-hair-regrowth': true,
                'menu-nad-plus': true,
                'menu-diabetes-care': false,  // Disabled for testing
                'section-weight-loss': true,
                'section-ed-meds': true,
                'carousel-diabetes-care': false,  // Disabled for testing
                'test-created-on': new Date().toISOString(),
                'test-domain': window.location.hostname
            };
            
            localStorage.setItem('herosSiteSettings', JSON.stringify(testSettings));
            addTestResult('storage-test-results', '✅ Test settings created', 'pass');
            refreshStatus();
        }

        function createDemoSettings() {
            const demoSettings = {
                'menu-weight-loss': true,
                'menu-mens-ed': true,
                'menu-skin-care': true,
                'menu-hair-regrowth': true,
                'menu-nad-plus': false,        // Demo: disabled
                'menu-diabetes-care': false,   // Demo: disabled
                'section-hero': true,
                'section-service-cards': true,
                'section-products': true,
                'section-weight-loss': false,  // Demo: disabled
                'section-ed-meds': true,
                'carousel-nad-plus': false,    // Demo: disabled
                'carousel-diabetes-care': false, // Demo: disabled
                'demo-created': true,
                'demo-timestamp': Date.now()
            };
            
            localStorage.setItem('herosSiteSettings', JSON.stringify(demoSettings));
            
            const changeNotification = {
                timestamp: Date.now(),
                setting: 'demo-settings',
                action: 'domain-agnostic-demo'
            };
            localStorage.setItem('herosSettingsChange', JSON.stringify(changeNotification));
            
            alert('🎭 Demo settings created!\n\nNAD+ and Diabetes Care items are now disabled for demonstration.\nOpen the main site to see the changes.');
            refreshStatus();
        }

        function clearAllData() {
            if (confirm('🗑️ Clear all settings data?\n\nThis will remove all settings and cannot be undone.')) {
                localStorage.removeItem('herosSiteSettings');
                localStorage.removeItem('herosSettingsChange');
                alert('✅ All data cleared!');
                refreshStatus();
            }
        }

        function refreshStatus() {
            try {
                const settingsData = localStorage.getItem('herosSiteSettings');
                
                if (settingsData) {
                    const settings = JSON.parse(settingsData);
                    const total = Object.keys(settings).length;
                    const enabled = Object.values(settings).filter(v => v === true).length;
                    const disabled = total - enabled;
                    
                    document.getElementById('total-settings').textContent = total;
                    document.getElementById('enabled-settings').textContent = enabled;
                    document.getElementById('disabled-settings').textContent = disabled;
                } else {
                    document.getElementById('total-settings').textContent = '0';
                    document.getElementById('enabled-settings').textContent = '0';
                    document.getElementById('disabled-settings').textContent = '0';
                }
            } catch (error) {
                document.getElementById('total-settings').textContent = 'Error';
                document.getElementById('enabled-settings').textContent = 'Error';
                document.getElementById('disabled-settings').textContent = 'Error';
            }
        }

        function updateTestSummary() {
            const summaryDiv = document.getElementById('test-summary');
            const successRate = testResults.totalTests > 0 
                ? Math.round((testResults.passedTests / testResults.totalTests) * 100)
                : 0;
            
            summaryDiv.innerHTML = `
                <div class="test-result test-info">
                    <strong>📊 Test Summary</strong><br>
                    Total Tests: ${testResults.totalTests}<br>
                    Passed: ${testResults.passedTests}<br>
                    Success Rate: ${successRate}%<br>
                    Settings Tests: ${testResults.settingsTests}<br>
                    URL Tests: ${testResults.urlTests}<br>
                    Storage Tests: ${testResults.storageTests}
                </div>
                <div class="test-result ${successRate >= 80 ? 'test-pass' : 'test-fail'}">
                    ${successRate >= 80 
                        ? '✅ Domain agnostic system is working correctly!' 
                        : '❌ Some tests failed. System may need fixes.'}
                </div>
            `;
        }
    </script>
</body>
</html>
