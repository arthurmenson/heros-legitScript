<!DOCTYPE html>
<html data-wf-page="skincare-account" data-wf-site="682f5a8cf58ac9034f80ba80" lang="en">
<head>
  <meta charset="utf-8">
  <title>Create Your Skincare Account - Secure Dermatology Portal</title>
  <meta content="Create your secure account to access personalized skincare treatments and dermatologist consultations." name="description">
  <meta content="Create Your Skincare Account - Secure Dermatology Portal" property="og:title">
  <meta content="Create your secure account to access personalized skincare treatments and dermatologist consultations." property="og:description">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/heros-fd8f11.webflow.css" rel="stylesheet" type="text/css">
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon">

  <!-- Database Integration -->
  <script src="js/database.js"></script>

  <style>
    body {
      font-family: 'RethinkSans', Arial, sans-serif;
      background: linear-gradient(135deg, #fff5f5 0%, #f0fdfa 100%);
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    
    .account-container {
      max-width: 600px;
      margin: 0 auto;
      padding: 40px 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    .account-header {
      text-align: center;
      margin-bottom: 40px;
      background: white;
      padding: 32px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }
    
    .security-badge {
      display: inline-block;
      background: linear-gradient(90deg, #ff6b6b 0%, #4ecdc4 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .account-form {
      background: white;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }
    
    .form-group {
      margin-bottom: 24px;
    }
    
    .form-label {
      display: block;
      font-weight: 600;
      font-size: 16px;
      color: #1a1a1a;
      margin-bottom: 8px;
    }
    
    .form-label.required::after {
      content: " *";
      color: #ff6b6b;
    }
    
    .form-input {
      width: 100%;
      padding: 16px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 16px;
      font-family: inherit;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }
    
    .form-input:focus {
      outline: none;
      border-color: #ff6b6b;
      box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
    }
    
    .form-input.error {
      border-color: #dc3545;
      box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
    }
    
    .form-input.valid {
      border-color: #28a745;
      box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
    }
    
    .error-message {
      color: #dc3545;
      font-size: 14px;
      margin-top: 6px;
      display: none;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    .form-help {
      font-size: 14px;
      color: #666;
      margin-top: 6px;
      line-height: 1.4;
    }
    
    .privacy-notice {
      background: #fff5f5;
      border: 1px solid #ffcccb;
      border-radius: 8px;
      padding: 20px;
      margin: 24px 0;
    }
    
    .privacy-notice h4 {
      margin: 0 0 12px 0;
      color: #1a1a1a;
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .privacy-notice p {
      margin: 0;
      color: #666;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .security-features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 24px 0;
    }
    
    .security-feature {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 14px;
      color: #666;
      background: white;
      padding: 16px;
      border-radius: 8px;
      border: 1px solid #e9ecef;
    }
    
    .security-icon {
      color: #ff6b6b;
      font-weight: bold;
      font-size: 16px;
    }
    
    .form-actions {
      display: flex;
      gap: 16px;
      margin-top: 32px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 16px 32px;
      border-radius: 8px;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      border: none;
      font-size: 16px;
      transition: all 0.3s ease;
      flex: 1;
      min-width: 200px;
      text-align: center;
      display: inline-block;
      font-family: inherit;
    }
    
    .btn-primary {
      background: #ff6b6b;
      color: white;
    }
    
    .btn-primary:hover:not(:disabled) {
      transform: scale(1.02);
      box-shadow: 0 4px 16px rgba(255, 107, 107, 0.3);
    }
    
    .btn-primary:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .btn-secondary {
      background: transparent;
      color: #666;
      border: 2px solid #e9ecef;
    }
    
    .btn-secondary:hover {
      border-color: #ccc;
      color: #333;
    }
    
    .loading-spinner {
      display: none;
      width: 20px;
      height: 20px;
      border: 2px solid #ffffff;
      border-top: 2px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .success-message {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 24px;
      display: none;
    }
    
    @media (max-width: 768px) {
      .account-container {
        padding: 20px 16px;
      }
      
      .account-form {
        padding: 24px;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .btn {
        min-width: auto;
      }
      
      .security-features {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="account-container">
    <!-- Account Header -->
    <div class="account-header">
      <div class="security-badge">🔒 Dermatologist-Grade Security</div>
      <h1 style="margin: 0 0 16px 0; font-size: 36px; font-weight: 700; color: #1a1a1a;">Create Your Skincare Account</h1>
      <p style="margin: 0; font-size: 18px; color: #666; line-height: 1.5;">Your personalized skincare assessment is complete. Create your secure account to access custom treatments and connect with licensed dermatologists.</p>
    </div>

    <!-- Account Form -->
    <div class="account-form">
      <div class="success-message" id="successMessage">
        <strong>✓ Account created successfully!</strong> Redirecting to your skincare consultation...
      </div>

      <form id="accountForm" novalidate>
        <div class="form-row">
          <div class="form-group">
            <label for="firstName" class="form-label required">First Name</label>
            <input 
              type="text" 
              id="firstName" 
              name="firstName" 
              class="form-input" 
              placeholder="Enter your first name"
              required
            >
            <div class="error-message" id="firstNameError">Please enter your first name</div>
          </div>
          
          <div class="form-group">
            <label for="lastName" class="form-label required">Last Name</label>
            <input 
              type="text" 
              id="lastName" 
              name="lastName" 
              class="form-input" 
              placeholder="Enter your last name"
              required
            >
            <div class="error-message" id="lastNameError">Please enter your last name</div>
          </div>
        </div>

        <div class="form-group">
          <label for="email" class="form-label required">Email Address</label>
          <input 
            type="email" 
            id="email" 
            name="email" 
            class="form-input" 
            placeholder="Enter your email address"
            required
          >
          <div class="form-help">We'll use this for treatment updates and secure dermatologist communications</div>
          <div class="error-message" id="emailError">Please enter a valid email address</div>
        </div>

        <div class="form-group">
          <label for="dateOfBirth" class="form-label required">Date of Birth</label>
          <input 
            type="date" 
            id="dateOfBirth" 
            name="dateOfBirth" 
            class="form-input" 
            required
            max="2006-01-01"
          >
          <div class="form-help">Must be 18 years or older for prescription skincare treatments</div>
          <div class="error-message" id="dobError">Please enter a valid date of birth</div>
        </div>

        <div class="privacy-notice">
          <h4>�� Your Skincare Privacy & Security</h4>
          <p>Your skin profile and personal information are encrypted and protected under medical privacy regulations. We never share your skincare data or photos with third parties. All dermatologist consultations are secure and confidential.</p>
        </div>

        <div class="security-features">
          <div class="security-feature">
            <span class="security-icon">🔒</span>
            <span>256-bit medical encryption</span>
          </div>
          <div class="security-feature">
            <span class="security-icon">👩‍⚕️</span>
            <span>Licensed dermatologist care</span>
          </div>
          <div class="security-feature">
            <span class="security-icon">🛡️</span>
            <span>Private skin profile storage</span>
          </div>
          <div class="security-feature">
            <span class="security-icon">📱</span>
            <span>Secure photo uploads</span>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary" id="submitBtn">
            <span class="loading-spinner" id="loadingSpinner"></span>
            <span id="submitText">Create Account & Continue</span>
          </button>
          <a href="skincare-quiz.html" class="btn btn-secondary">← Back to Assessment</a>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Form validation and submission
    const form = document.getElementById('accountForm');
    const submitBtn = document.getElementById('submitBtn');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const submitText = document.getElementById('submitText');
    const successMessage = document.getElementById('successMessage');

    // Real-time validation
    const inputs = {
      firstName: document.getElementById('firstName'),
      lastName: document.getElementById('lastName'),
      email: document.getElementById('email'),
      dateOfBirth: document.getElementById('dateOfBirth')
    };

    // Validation rules
    const validators = {
      firstName: (value) => value.trim().length >= 2,
      lastName: (value) => value.trim().length >= 2,
      email: (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value),
      dateOfBirth: (value) => {
        if (!value) return false;
        const birthDate = new Date(value);
        const today = new Date();
        const age = today.getFullYear() - birthDate.getFullYear();
        const monthDiff = today.getMonth() - birthDate.getMonth();
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
          age--;
        }
        return age >= 18 && age <= 120;
      }
    };

    // Error messages
    const errorMessages = {
      firstName: 'First name must be at least 2 characters',
      lastName: 'Last name must be at least 2 characters', 
      email: 'Please enter a valid email address',
      dateOfBirth: 'You must be 18 years or older for skincare treatments'
    };

    // Add event listeners for real-time validation
    Object.keys(inputs).forEach(fieldName => {
      const input = inputs[fieldName];

      // Handle special case for dateOfBirth which has ID 'dobError' instead of 'dateOfBirthError'
      const errorElementId = fieldName === 'dateOfBirth' ? 'dobError' : fieldName + 'Error';
      const errorElement = document.getElementById(errorElementId);

      if (!errorElement) {
        console.error(`Error element not found for field: ${fieldName} (looking for ID: ${errorElementId})`);
        return;
      }

      input.addEventListener('blur', () => validateField(fieldName));
      input.addEventListener('input', () => {
        if (input.classList.contains('error')) {
          validateField(fieldName);
        }
      });
    });

    function validateField(fieldName) {
      const input = inputs[fieldName];

      // Handle special case for dateOfBirth which has ID 'dobError' instead of 'dateOfBirthError'
      const errorElementId = fieldName === 'dateOfBirth' ? 'dobError' : fieldName + 'Error';
      const errorElement = document.getElementById(errorElementId);

      // Safety check to ensure errorElement exists
      if (!errorElement) {
        console.error(`Error element not found for field: ${fieldName} (looking for ID: ${errorElementId})`);
        return false;
      }

      const isValid = validators[fieldName](input.value);

      if (isValid) {
        input.classList.remove('error');
        input.classList.add('valid');
        errorElement.style.display = 'none';
      } else {
        input.classList.remove('valid');
        input.classList.add('error');
        errorElement.textContent = errorMessages[fieldName];
        errorElement.style.display = 'block';
      }

      return isValid;
    }

    function validateForm() {
      let isValid = true;
      Object.keys(inputs).forEach(fieldName => {
        if (!validateField(fieldName)) {
          isValid = false;
        }
      });
      return isValid;
    }

    // Handle form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!validateForm()) {
        return;
      }

      // Show loading state
      submitBtn.disabled = true;
      loadingSpinner.style.display = 'inline-block';
      submitText.textContent = 'Creating Skincare Profile...';

      try {
        // Check if email already exists
        const emailExists = await window.db.checkEmailExists(inputs.email.value.trim());
        if (emailExists) {
          throw new Error('An account with this email already exists');
        }

        // Prepare user data
        const userData = {
          firstName: inputs.firstName.value.trim(),
          lastName: inputs.lastName.value.trim(),
          email: inputs.email.value.trim(),
          dateOfBirth: inputs.dateOfBirth.value,
          accountType: 'skincare'
        };

        // Get quiz data from localStorage if available
        const quizDataString = localStorage.getItem('skincareQuizAnswers');
        if (quizDataString) {
          try {
            userData.quizData = {
              skincare: JSON.parse(quizDataString)
            };
          } catch (parseError) {
            console.warn('Could not parse skincare quiz data:', parseError);
          }
        }

        // Create user in Supabase database
        const result = await window.db.createUser(userData);

        if (!result.success) {
          throw new Error(result.error || 'Failed to create skincare account');
        }

        // Store user ID for session
        localStorage.setItem('currentUserId', result.user.id);
        localStorage.setItem('userEmail', result.user.email);

        // Clear quiz data from localStorage after successful account creation
        localStorage.removeItem('skincareQuizAnswers');

        // Show success message
        successMessage.innerHTML = `<strong>✓ Skincare account created successfully!</strong> Welcome ${userData.firstName}! Your personalized skincare profile is ready. Redirecting to your consultation...`;
        successMessage.style.display = 'block';
        form.style.display = 'none';

        // Redirect to consultation after short delay
        setTimeout(() => {
          window.location.href = 'skin-care.html';
        }, 2000);

      } catch (error) {
        // Handle error
        console.error('Skincare account creation failed:', error);

        let errorMessage = 'Skincare account creation failed. Please try again.';
        if (error.message.includes('email already exists')) {
          errorMessage = 'An account with this email address already exists. Please use a different email or try logging in.';
        } else if (error.message.includes('Database error') || error.message.includes('Failed to connect')) {
          errorMessage = 'There was a problem connecting to our servers. Your skincare profile has been saved locally and will be synchronized when the connection is restored.';
        } else if (error.message.includes('Missing required fields')) {
          errorMessage = 'Please fill in all required fields correctly.';
        }

        // Show error in a more user-friendly way
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.style.cssText = 'background: #f8d7da; color: #721c24; padding: 12px; border-radius: 6px; margin: 10px 0; border: 1px solid #f5c6cb;';
        errorDiv.textContent = errorMessage;

        form.insertBefore(errorDiv, form.firstChild);

        // Auto-hide error after 10 seconds
        setTimeout(() => {
          if (errorDiv.parentNode) {
            errorDiv.parentNode.removeChild(errorDiv);
          }
        }, 10000);

        // Reset button state
        submitBtn.disabled = false;
        loadingSpinner.style.display = 'none';
        submitText.textContent = 'Create Account & Continue';
      }
    });

    // Set max date for date of birth (18 years ago)
    const eighteenYearsAgo = new Date();
    eighteenYearsAgo.setFullYear(eighteenYearsAgo.getFullYear() - 18);
    inputs.dateOfBirth.max = eighteenYearsAgo.toISOString().split('T')[0];
  </script>
</body>
</html>
